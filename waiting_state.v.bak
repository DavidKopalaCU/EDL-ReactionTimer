module waiting_state(
	input						en,
	input 					clk,
	input				[1:0] KEY,
	output	wire	[9:0] LEDR,
	output	wire	[3:0] out_state
);

reg [31:0]	delay;
reg [31:0]	clk_cnt;
reg			started;

reg clk_done;

always @(negedge en)
begin
	delay <= 29'hfffffff;
end

assign LEDR = clk_cnt[27:18];

always @(posedge clk)
begin
	if (!en)
	begin
		clk_done <= 0;
		clk_cnt <= delay;
		started <= 0;
	end
	else if (started == 0)
	begin
		clk_cnt <= delay;
		started <= 1;
	end
	
	else
	begin
		if (clk_cnt == 0)
		begin
			clk_done <= 1;
		end
		else
		begin
			clk_cnt <= clk_cnt - 1;
		end
	end
end

assign out_state = en ? ((clk_cnt == 0) ? 2 : KEY[1]) : 1;

endmodule
